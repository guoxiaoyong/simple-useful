#include <stdio.h>
#include <pcap.h>

#include "digital_crc32.h"


u_char beacon[] = {
        0x00,0x00,0x22,0x00,0x2f,0x48,0x00,0x00,0x8c,0x23,
        0xc4,0xb4,0x00,0x00,0x00,0x00,0x10,0x02,0x8f,0x09,
        0xa0,0x00,0xcd,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x80,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0x10,0x6f,0x3f,0x1b,0xae,0x60,0x10,0x6f,0x3f,0x1b,0xae,0x60,0xa0,0x24,0x3e,0xa1,0x93,0x12,0x0a,0x00,0x00,0x00,0x64,0x00,0x11,0x04,0x00,0x07,0x70,0x65,0x61,0x64,0x6f,0x63,0x6b,0x01,0x08,0x82,0x84,0x8b,0x96,0x12,0x24,0x48,0x6c,0x03,0x01,0x08,0x32,0x04,0x0c,0x18,0x30,0x60,0x07,0x06,0x47,0x42,0x20,0x01,0x0b,0x14,0x33,0x08,0x20,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x33,0x08,0x21,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0xdd,0x27,0x00,0x50,0xf2,0x04,0x10,0x4a,0x00,0x01,0x10,0x10,0x44,0x00,0x01,0x02,0x10,0x47,0x00,0x10,0x28,0x80,0x28,0x80,0x28,0x80,0x18,0x80,0xa8,0x80,0x10,0x6f,0x3f,0x1b,0xae,0x60,0x10,0x3c,0x00,0x01,0x01,0x05,0x04,0x00,0x01,0x01,0x03,0x2a,0x01,0x04,0x2d,0x1a,0x6c,0x00,0x17,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x00,0x00,0x00,0x00,0x00,0x3d,0x16,0x08,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7f,0x01,0x01,0xdd,0x16,0x00,0x50,0xf2,0x01,0x01,0x00,0x00,0x50,0xf2,0x04,0x01,0x00,0x00,0x50,0xf2,0x04,0x01,0x00,0x00,0x50,0xf2,0x02,0xdd,0x18,0x00,0x50,0xf2,0x02,0x01,0x01,0x00,0x00,0x03,0xa4,0x00,0x00,0x27,0xa4,0x00,0x00,0x42,0x43,0x5e,0x00,0x62,0x32,0x2f,0x00,0x0b,0x05,0x03,0x00,0x09,0x12,0x7a,0xdd,0x1e,0x00,0x90,0x4c,0x33,0x6c,0x00,0x17,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x00,0x00,0x00,0x00,0x00,0xdd,0x1a,0x00,0x90,0x4c,0x34,0x08,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xdd,0x07,0x00,0x0c,0x43,0x04,0x00,0x00,0x00,0x63,0x66,0x5a,0xa2};

//u_char beacon[] = {0x00,0x00,0x22,0x00,0x2f,0x48,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x02,0x6c,0x09,0xa0,0x00,0xd9,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x02,0x0c,0xdf,0x49,0x16,0x00,0x02,0x0c,0xdf,0x49,0x16,0x60,0x04,0x3a,0x61,0x6d,0x00,0x00,0x00,0x00,0x00,0x64,0x00,0x11,0x04,0x00,0x0a,0x58,0x53,0x53,0x2d,0x44,0x46,0x34,0x39,0x31,0x36,0x01,0x08,0x82,0x84,0x8b,0x96,0x12,0x24,0x48,0x6c,0x03,0x01,0x01,0x32,0x04,0x0c,0x18,0x30,0x60,0x07,0x06,0x43,0x4e,0x20,0x01,0x0b,0x14,0x33,0x08,0x20,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x33,0x08,0x21,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x05,0x04,0x00,0x01,0x00,0x00,0x2a,0x01,0x04,0xdd,0x18,0x00,0x50,0xf2,0x02,0x01,0x01,0x05,0x40,0x03,0xa4,0x00,0x00,0x27,0xa4,0x00,0x00,0x42,0x43,0x5e,0x00,0x62,0x32,0x2f,0x00,0x0b,0x05,0x02,0x00,0x08,0x12,0x7a,0xdd,0x07,0x00,0x0c,0x43,0x07,0x00,0x00,0x00,0x23,0x3d,0x9d,0xeb};


int main(int argc, char *argv[]) {


    //unsigned int crc = digital_crc32(beacon+34, sizeof(beacon)-4-34);
    unsigned char dat[] = "Hello, World!";
    unsigned int crc = digital_crc32(dat, sizeof(dat)-1);
    unsigned char* ptr = &crc;
    printf("%02x, %2x, %2x, %2x\n", ptr[0], ptr[1], ptr[2], ptr[3]);
    printf("%08x\n", crc);

#if 0
    char *dev, errbuf[PCAP_ERRBUF_SIZE];

    dev = argv[1];
    printf("Device: %s\n", dev);

    pcap_t* handle;
    handle = pcap_open_live(dev, BUFSIZ, 1, 1000, errbuf);

    if (handle == NULL) {
        fprintf(stderr, "Couldn't open device %s: %s\n", dev, errbuf);
        return(2);
    }

    printf("BUFSIZ = %d\n", BUFSIZ);
    printf("beacon len = %d\n", sizeof(beacon));

    int n;
    for (n = 0; n < 1000000; n++)
    {
        int info = pcap_inject(handle, beacon, sizeof(beacon));
        usleep(100000);
        if (info == -1) {
            fprintf(stderr, "failed to send a packet, %d\n", n);
        }
        else {
            fprintf(stderr, "successfully send a packet %d, %d\n", n, info);
        }
    }

    pcap_close(handle);
#endif

    return(0);
}


